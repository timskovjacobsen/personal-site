<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>Graham Scan algorithm for convex hulls - Tim Skov Jacobsen</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=cache-control content="no-transform">
<meta http-equiv=cache-control content="no-siteapp">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=author content="Tim Skov Jacobsen"><meta name=description content="This is the description"><meta name=keywords content="Hugo,theme,even,programming,blog">
<meta name=generator content="Hugo 0.87.0 with theme even">
<link rel=canonical href=http://localhost:1313/post/convex-hull/>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/manifest.json>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<link href=/sass/main.min.8ffdca6427f4ad3813afddb0caf90c38cebcb60bf9bc6ae9ad7835309f9a8009.css rel=stylesheet>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous>
<link rel=stylesheet href=/css/custom.css>
<meta property="og:title" content="Graham Scan algorithm for convex hulls">
<meta property="og:description" content="This is the description">
<meta property="og:type" content="article">
<meta property="og:url" content="http://localhost:1313/post/convex-hull/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2021-08-10T10:56:59+02:00">
<meta property="article:modified_time" content="2021-08-23T22:53:36+02:00">
<meta itemprop=name content="Graham Scan algorithm for convex hulls">
<meta itemprop=description content="This is the description"><meta itemprop=datePublished content="2021-08-10T10:56:59+02:00">
<meta itemprop=dateModified content="2021-08-23T22:53:36+02:00">
<meta itemprop=wordCount content="2983">
<meta itemprop=keywords content="convex-hull,algorithms,computational-geometry,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Graham Scan algorithm for convex hulls">
<meta name=twitter:description content="This is the description"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>Tim Skov Jacobsen</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<a href=/>
<li class=mobile-menu-item>Blog</li>
</a><a href=/post/>
<li class=mobile-menu-item>Archive</li>
</a><a href=/tags/>
<li class=mobile-menu-item>Tags</li>
</a><a href=/categories/>
<li class=mobile-menu-item>Categories</li>
</a><a href=/about/>
<li class=mobile-menu-item>About</li>
</a><a href=/about/>
<li class=mobile-menu-item></li>
</a>
</ul>
</nav>
<div class=container id=mobile-panel>
<header id=header class=header>
<link rel=preconnect href=https://fonts.gstatic.com>
<link href="https://fonts.googleapis.com/css2?family=Raleway:wght@700&display=swap" rel=stylesheet>
<link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel=stylesheet>
<link href="https://fonts.googleapis.com/css2?family=Merriweather+Sans:wght@300&display=swap" rel=stylesheet>
<link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@600&display=swap" rel=stylesheet>
<link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@300&display=swap" rel=stylesheet>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel=stylesheet>
<div class=logo-wrapper>
<a href=/about/ class=logo>Tim Skov Jacobsen</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=/>Blog</a>
</li><li class=menu-item>
<a class=menu-item-link href=/post/>Archive</a>
</li><li class=menu-item>
<a class=menu-item-link href=/tags/>Tags</a>
</li><li class=menu-item>
<a class=menu-item-link href=/categories/>Categories</a>
</li><li class=menu-item>
<a class=menu-item-link href=/about/>About</a>
</li><li class=menu-item>
<a class=menu-item-link href=/about/></a>
</li>
</ul>
</nav>
</header>
<main id=main class=main>
<div class=content-wrapper>
<div id=content class=content>
<article class=post>
<header class=post-header>
<h1 class=post-title>Graham Scan algorithm for convex hulls</h1>
<div class=post-meta>
<span class=post-time> 2021-08-10 </span>
<span class=more-meta> 2983 words </span>
<span class=more-meta> 15 mins read </span>
</div>
<div class=post-content>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title>Contents</h2>
<div class="post-toc-content always-active">
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#visualizing-the-algorithm>Visualizing the algorithm</a>
<ul>
<li><a href=#preprocessing-part>Preprocessing part</a></li>
<li><a href=#loop-part>Loop part</a></li>
</ul>
</li>
<li><a href=#comments>Comments</a>
<ul>
<li><a href=#time-complexity>Time complexity</a></li>
<li><a href=#detecting-direction-of-turns>Detecting direction of turns</a></li>
</ul>
</li>
<li><a href=#implementation>Implementation</a></li>
<li><a href=#references>References</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
<div class=post-content>
<p>Have you ever wanted to compute the outer boundary of a bunch of scattered points? Maybe you have data in point cloud form from an object scan and want to detect the outer perimeter.</p>
<p>In this post, we will take a look at an efficient way of computing the so-called <em>convex hull</em> of a set of points in 2D.</p>
<div class="admonition tip"><p class=admonition-title>Convex Hull</p>
<p>A convex hull is a convex polygon that encloses all the points in a point set.</p>
<p>The convexity requirement dictates that if we were to follow the path around the convex hull in a counter-clockwise fashion, we must only make left turns.</p>
</div>
<p>One way to efficiently compute the convex hull of an array of points is by using the <em>Graham Scan</em> algorithm. It has a time complexity of $O(n \log n)$, similar to many other algorithms for finding the convex hull.</p>
<h2 id=visualizing-the-algorithm>Visualizing the algorithm</h2>
<p>Understanding the algorithm is easiest through an example. Let&rsquo;s consider the points in this plot</p>
<center>
<p><img src=/img/convex-hull/example/points.png alt=points></p>
</center>
<h3 id=preprocessing-part>Preprocessing part</h3>
<p>Before we start looping over the points to find the convex hull, we will do some setup or <em>preprocessing</em> or the problem:</p>
<ol>
<li>
<p>The first thing to do is finding the source point, where we will start the algorithm from. Here, we will denote it as the <strong>anchor point</strong>.</p>
<p>The anchor point is found as the point with the lowest $y$-coordinate. In case we have a tie, we take the point with the lowest $x$-coordinate among the ties.</p>
<p>Visually, it&rsquo;s quite easy to see that <strong>Point $12$</strong> is the anchor point for this example.</p>
</li>
<li>
<p>Next, we need to sort our points according to their angle with the anchor point. E.g., for Point $13$, we would measure the angle between the $x$-axis and the line going through Point $12$ and $13$. The result of this sorting will dictate in which order we will process the points when finding the convex hull. While it&rsquo;s not strictly necessary, we can now remove the anchor point from the list.</p>
<center>
<p><img src=/img/convex-hull/angle-sorting.svg alt="angle sorting"></p>
</center>
<p>where</p>
<p>$$
\alpha = \text{atan2}\left(\frac{\Delta y}{\Delta x}\right) = \text{atan2}\left(\frac{y_{15} - y_{12}}{x_{15} - x_{12}}\right)
$$</p>
</li>
<li>
<p>Initialize a <strong>stack</strong> to store the convex hull points.</p>
<p>At this state, we know that the anchor point is part of the convex hull, so we can already push that onto the stack. We are also guaranteed that the first point of the sorted list is part of the convex hull, so we push that to the stack as well. Take a couple of seconds to convince yourself that this point, i.e. Point $13$ in this example, will always be in the convex hull.</p>
</li>
</ol>
<p>We then continue to the part where we loop through the points in the sorted order. The tasks 1. and 2. are explained in each iteration.</p>
<h3 id=loop-part>Loop part</h3>
<p>After preprocessing, we start the loop that eventually finds that convex hull.</p>
<p>In each loop, we perform two tasks:</p>
<ol>
<li>
<p>A backtrack to see if any previously added points are still valid in the convex hull</p>
<p>The backtracking can be explained like this:</p>
<blockquote>
<p>If getting to the new point is <strong>not a left turn</strong>, the point in the current hull that was added latest should be removed. This point cannot possibly be in the convex hull as it violates the convex property.</p>
<p>If a point is removed, look at the next point until we backtrack to a point that is valid.</p>
</blockquote>
</li>
<li>
<p>Add the new point to the convex hull</p>
</li>
</ol>
<p>Note that even though we always add the current point, it might be taken away again by the backtracking in task 1. in later iterations.</p>
<p>Let&rsquo;s go trough the reach iteration of the example to understand the loop part better.</p>
<h4 id=iteration-0>Iteration 0</h4>
<p>The loop starts by considering Point $8$, the next point in to our preprocessed, sorted list. It&rsquo;s easy to see that this will be the next point since it has the smallest angle with the anchor point and horizontal out of the points left to consider.</p>
<center>
<p><img src=/img/convex-hull/example/iteration-0.png alt=iteration0></p>
</center>
<ol>
<li>
<p><strong>Backtrack</strong><br>
When travelling along the line $12 \rightarrow 13$ , getting to point $8$ is a left turn. Thus, we have have performed one backtracking step and found a valid point, so we remove nothing and continue.</p>
</li>
<li>
<p><strong>Add</strong><br>
We add the new point $8$ to the convex hull.</p>
</li>
</ol>
<div class="admonition info">
<p><em>We can see by simple visual inspection that Point $8$ will be in the convex hull. But the algorithm does not know that yet.</em></p>
</div>
<h4 id=iteration-1>Iteration 1</h4>
<p>The next point in the sorted list is $14$.</p>
<center>
<p><img src=/img/convex-hull/example/iteration-1.png alt=iteration1></p>
</center>
<ol>
<li>
<p><strong>Backtrack</strong><br>
When travelling along the line $13 \rightarrow 18$ , getting to point $14$ is a left turn. Thus, we have have performed one backtracking step and found a valid point, so we remove nothing and continue.</p>
</li>
<li>
<p><strong>Add</strong><br>
We add point $14$ to the convex hull.</p>
</li>
</ol>
<div class="admonition info">
<p>Adding point $14$ might look weird here, as we can see that it should actually not be part of the convex hull. It will however be removed again later.</p>
</div>
<h4 id=iteration-2>Iteration 2</h4>
<p>The next point is $15$.</p>
<center>
<p><img src=/img/convex-hull/example/iteration-2.png alt=iteration2></p>
</center>
<ol>
<li>
<p><strong>Backtrack</strong><br>
When travelling along the line $8 \rightarrow 14$ , getting to point $15$ is a left turn. Thus, we have have performed one backtracking step and found a valid point, so we remove nothing and continue.</p>
</li>
<li>
<p><strong>Add</strong><br>
We add point $15$ to the convex hull.</p>
</li>
</ol>
<h4 id=iteration-3>Iteration 3</h4>
<p>On to point $6$. This iteration is where we will see the smart part of the Graham Scan algorithm, so pay close attention!</p>
<center>
<p><img src=/img/convex-hull/example/iteration-3.png alt=iteration3></p>
</center>
<ol>
<li>
<p><strong>Backtrack</strong></p>
<ol>
<li>
<p>When travelling along the line $14 \rightarrow 15$ , getting to point $6$ is a <em>right</em> turn. In fact, a very sharp right turn.</p>
<p>When we hit a right turn, we must remove the point in the convex hull that was added latest. Thus, we remove $15$ and continue backtracking.</p>
</li>
<li>
<p>When travelling along the line $8 \rightarrow 14$ , getting to point $6$ is a <em>right</em> turn again.</p>
<p>This means that we must remove $14$ and continue backtracking.</p>
</li>
<li>
<p>When travelling along the line $13 \rightarrow 8$ , getting to point $6$ is a <em>left</em> turn again. We remove nothing and end the backtracking step.</p>
</li>
</ol>
</li>
<li>
<p><strong>Add</strong><br>
We add point $6$ to the convex hull.</p>
</li>
</ol>
<p>Now we have a good grasp of the backtracking step, so we can write some pseudocode in Python-like syntax.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>for</span> <span class=n>point</span> <span class=ow>in</span> <span class=s2>&#34;sorted-points-except-anchor-second-point&#34;</span><span class=p>:</span>
    <span class=k>while</span> <span class=s2>&#34;getting-to-next-point-is-not-a-left-turn&#34;</span><span class=p>:</span>
        <span class=n>convex_hull_stack</span><span class=o>.</span><span class=n>pop</span><span class=p>()</span>
    <span class=n>convex_hull_stack</span><span class=o>.</span><span class=n>push</span><span class=p>(</span><span class=n>point</span><span class=p>)</span>
</code></pre></td></tr></table>
</div>
</div><p>Notice that the convex hull is modeled as a Stack abstract data type. As a <strong>Last-In-First-Out</strong> data structure, it works perfectly for the backtracking characteristic. We must always remove (or pop) the point in the current hull that was latest put in and must always add (or push) the new point onto the convex hull.</p>
<h4 id=iteration-4>Iteration 4</h4>
<p>We have now definitively ruled out points $14$ and $15$ as candidates for the convex hull, so we mark them as greyed out in the plot.</p>
<p>The next point to consider is $7$, as it has the smallest angle between the anchor point $12$ and horizontal out of the remaining points to consider.</p>
<center>
<p><img src=/img/convex-hull/example/iteration-4.png alt=iteration4></p>
</center>
<ol>
<li>
<p><strong>Backtrack</strong></p>
<ol>
<li>
<p>When travelling along the line $8 \rightarrow 6$ , getting to point $7$ is a <em>right</em> turn. So we remove $6$ from the convex hull and continue backtracking.</p>
</li>
<li>
<p>When travelling along the line $13 \rightarrow 8$ , getting to point $7$ is a <em>left</em> turn. So we remove remove nothing and exit backtracking.</p>
</li>
</ol>
</li>
<li>
<p><strong>Add</strong><br>
We add point $7$ to the convex hull and grey out $6$.</p>
</li>
</ol>
<div class="admonition note">
<p>Note that once we during a backtrack determine that a point is valid, that point is &ldquo;locked&rdquo; into the convex hull. We are sure that it should be in the final hull. We might backtrack to it again to realize it&rsquo;s valid once more though. In fact, this is the second time we backtracked to $8$.</p>
</div>
<h4 id=iteration-5>Iteration 5</h4>
<p>The next point is $5$.</p>
<center>
<p><img src=/img/convex-hull/example/iteration-5.png alt=iteration5></p>
</center>
<ol>
<li>
<p><strong>Backtrack</strong><br>
Seen from the line $8 \rightarrow 7$, reaching point $5$ is a left turn. We exit backtracking.</p>
</li>
<li>
<p><strong>Add</strong><br>
We add point $5$ to the convex hull.</p>
</li>
</ol>
<h4 id=iteration-6>Iteration 6</h4>
<p>The next point in our sorted list is $3$.</p>
<center>
<p><img src=/img/convex-hull/example/iteration-6.png alt=iteration6></p>
</center>
<ol>
<li>
<p><strong>Backtrack</strong><br>
Getting to $3$ is a left turn, so we don&rsquo;t need to backtrack.</p>
</li>
<li>
<p><strong>Add</strong><br>
We add point $3$ to the convex hull.</p>
</li>
</ol>
<h4 id=iteration-7>Iteration 7</h4>
<p>The next point is $4$. Notice how point $5$, $3$, and $4$ are (almost) colinear. They might not be exactly due to numerical inaccuracies, but let&rsquo;s assume for this explanation that they are colinear.</p>
<center>
<p><img src=/img/convex-hull/example/iteration-7.png alt=iteration7></p>
</center>
<ol>
<li>
<p><strong>Backtrack</strong></p>
<ol>
<li>
<p>When travelling along the line $5 \rightarrow 3$, getting to point $4$ is <em>not a left turn</em>. Since we assume the points are colinear, there is no turn at all. We remove point $3$ because it&rsquo;s the point in the hull that was latest added and continue backtracking.</p>
</li>
<li>
<p>When travelling along the line $7 \rightarrow 5$, getting to point $4$ is <em>left turn</em>. We exit backtracking.</p>
</li>
</ol>
</li>
<li>
<p><strong>Add</strong><br>
We add point $4$ to the convex hull.</p>
</li>
</ol>
<h4 id=iteration-8>Iteration 8</h4>
<p>The next point is $9$.</p>
<center>
<p><img src=/img/convex-hull/example/iteration-8.png alt=iteration8></p>
</center>
<ol>
<li>
<p><strong>Backtrack</strong><br>
When travelling along the line $5 \rightarrow 4$, getting to point $9$ is a slight turn to the left. We don&rsquo;t backtrack on left turns.</p>
</li>
<li>
<p><strong>Add</strong><br>
We add point $9$ to the convex hull.</p>
</li>
</ol>
<h4 id=iteration-9>Iteration 9</h4>
<p>Point $1$ up next.</p>
<center>
<p><img src=/img/convex-hull/example/iteration-9.png alt=iteration9></p>
</center>
<ol>
<li>
<p><strong>Backtrack</strong></p>
<ol>
<li>
<p>From line $4 \rightarrow 9$, moving to point $1$ is a right turn. We know that point $9$ cannot be in the hull and remove it. Backtracking continues.</p>
</li>
<li>
<p>Moving on to line $5 \rightarrow 4$, from which getting to point $1$ is also a right turn. We discard point $4$ as well and continue backtracking.</p>
</li>
<li>
<p>Line $7 \rightarrow 5$ is now in consideration. Getting to point $1$ finally becomes a left turn and we can exit the backtracking without further removals.</p>
</li>
</ol>
</li>
<li>
<p><strong>Add</strong><br>
Point $1$ is added to the convex_hull.</p>
</li>
</ol>
<h4 id=iteration-10>Iteration 10</h4>
<p>On to point $2$.</p>
<center>
<p><img src=/img/convex-hull/example/iteration-10.png alt=iteration10></p>
</center>
<ol>
<li>
<p><strong>Backtrack</strong></p>
<ol>
<li>Considering line $5 \rightarrow 1$, travelling to point $2$ requires a right turn. Point $1$ is removed and we can continue backtracking.</li>
<li>We go back to line $7 \rightarrow 5$ and see a left turn to get to $2$, and exit backtracking.</li>
</ol>
</li>
<li>
<p><strong>Add</strong><br>
Add point $2$.</p>
</li>
</ol>
<h4 id=iteration-11>Iteration 11</h4>
<p>On to point $11$.</p>
<center>
<p><img src=/img/convex-hull/example/iteration-11.png alt=iteration11></p>
</center>
<ol>
<li>
<p><strong>Backtrack</strong><br>
Getting to point $11$ from $5 \rightarrow 2$ is a left turn. Done!</p>
</li>
<li>
<p><strong>Add</strong><br>
Add point $11$</p>
</li>
</ol>
<h4 id=iteration-12>Iteration 12</h4>
<p>Point $10$ is up next.</p>
<center>
<p><img src=/img/convex-hull/example/iteration-12.png alt=iteration12></p>
</center>
<ol>
<li>
<p><strong>Backtrack</strong></p>
<ol>
<li>
<p>Getting to point $10$ from $2 \rightarrow 11$ is a right turn. Remove $11$ and continue to backtrack.</p>
</li>
<li>
<p>Getting to point $10$ from $5 \rightarrow 2$ is a left turn. No need to backtrack anymore.</p>
</li>
</ol>
</li>
<li>
<p><strong>Add</strong><br>
Add point $10$.</p>
</li>
</ol>
<h4 id=final-convex-hull>Final convex hull</h4>
<p>There are no more points left to consider. We finish the convex hull by connecting the last point to the anchor point and we are done!</p>
<center>
<p><img src=/img/convex-hull/example/final-hull.png alt=final-hull></p>
</center>
<h2 id=comments>Comments</h2>
<h3 id=time-complexity>Time complexity</h3>
<p>You might be wondering why the time complexity of the algorithm becomes $O(n \log n)$.</p>
<div class="admonition note"><p class=admonition-title>Sorting governs time complexity</p>
<p>The sorting in Step 2 of the preprocessing part is the critical element for the time complexity of the algorithm, since it is the computationally most expensive thing we are doing. The fastest sorting algorithms run in $O(n \log n )$, which makes Graham Scan an $O(n \log n)$ algorithm.</p>
</div>
<p>In the loop, we are only backtracking a few steps in each iteration. This can be regarded as constant time, i.e. $O(1)$. Therefore we can say that the loop has $O(n)$ time complexity. Had the backtracking step gone all the way back to the anchor point each time, we would have a time complexity of $O(n²)$. Fortunately, the algorithm is smarter than that.</p>
<p>This brings us to</p>
<p>$$
O(n \log n) + O(n) \Longrightarrow O(n \log n)
$$</p>
<h3 id=detecting-direction-of-turns>Detecting direction of turns</h3>
<p>As we&rsquo;ve seen, the algorithm relies heavily on determining which way we must turn to get to the next point. If we consider the triangle formed by the two last points added to the current convex hull and the new point, we can compute the determinant to find its area.</p>
<p>If we arrange the points correctly according to our chosen counter-clockwise order, the sign of the area will reveal whether getting to the new point is a left or right turn. Or even if the points are colinear.</p>
<p>Let&rsquo;s say we have $k$ points in a current convex hull called $h$. We then consider the line from $h[k-1] \rightarrow h[k]$. We can then say the following about the turn required to get to a new point $p$.</p>
<center>
<table>
<thead>
<tr>
<th style=text-align:left>Area sign</th>
<th style=text-align:left>Direction for turn</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>Positive</td>
<td style=text-align:left>Getting to point $p$ requires a left turn, i.e. a counter-clockwise turn</td>
</tr>
<tr>
<td style=text-align:left>Negative</td>
<td style=text-align:left>Getting to point $p$ requires a right turn, i.e. a clockwise turn</td>
</tr>
<tr>
<td style=text-align:left>Zero</td>
<td style=text-align:left>The points $h[k-1]$, $h[k]$ and $p$ are on a straight line, i.e. colinear</td>
</tr>
</tbody>
</table>
</center>
<p>With all the information above, we can begin writing an implementation.</p>
<h2 id=implementation>Implementation</h2>
<p>Before we get to implementing the actual Graham Scan algorithm, let&rsquo;s create some point objects that we can work with.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=c1># core.py</span>
<span class=kn>from</span> <span class=nn>__future__</span> <span class=kn>import</span> <span class=n>annotations</span>
<span class=kn>from</span> <span class=nn>math</span> <span class=kn>import</span> <span class=n>atan2</span>
<span class=kn>from</span> <span class=nn>dataclasses</span> <span class=kn>import</span> <span class=n>dataclass</span>


<span class=nd>@dataclass</span>
<span class=k>class</span> <span class=nc>Point</span><span class=p>:</span>
    <span class=n>x</span><span class=p>:</span> <span class=nb>float</span>
    <span class=n>y</span><span class=p>:</span> <span class=nb>float</span>

    <span class=k>def</span> <span class=nf>angle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>other</span><span class=p>:</span> <span class=n>Point</span><span class=p>):</span>
        <span class=s2>&#34;&#34;&#34;Return the angle between a line a horizontal.
</span><span class=s2>
</span><span class=s2>        The line is defined by the instance and another point.&#34;&#34;&#34;</span>
        <span class=n>dx</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>x</span> <span class=o>-</span> <span class=n>other</span><span class=o>.</span><span class=n>x</span>
        <span class=n>dy</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>other</span><span class=o>.</span><span class=n>y</span>
        <span class=k>return</span> <span class=n>atan2</span><span class=p>(</span><span class=n>dy</span><span class=p>,</span> <span class=n>dx</span><span class=p>)</span>

    <span class=k>def</span> <span class=nf>distance_to</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>other</span><span class=p>:</span> <span class=n>Point</span><span class=p>):</span>
        <span class=s2>&#34;&#34;&#34;Return the Euclidian distance to from the point to another point.&#34;&#34;&#34;</span>
        <span class=n>dx</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>x</span> <span class=o>-</span> <span class=n>other</span><span class=o>.</span><span class=n>x</span>
        <span class=n>dy</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>x</span> <span class=o>-</span> <span class=n>other</span><span class=o>.</span><span class=n>y</span>
        <span class=k>return</span> <span class=p>(</span><span class=n>dx</span> <span class=o>**</span> <span class=mi>2</span> <span class=o>+</span> <span class=n>dy</span> <span class=o>**</span> <span class=mi>2</span><span class=p>)</span> <span class=o>**</span> <span class=mf>0.5</span>

    <span class=k>def</span> <span class=nf>determinant</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>other1</span><span class=p>,</span> <span class=n>other2</span><span class=p>):</span>
        <span class=s2>&#34;&#34;&#34;Return the determinant of the three points.
</span><span class=s2>
</span><span class=s2>        The determinant represents the area of the triangle formed by the points.
</span><span class=s2>
</span><span class=s2>        We consider the line from `other1` to `other2`. The turn to get to point
</span><span class=s2>        `self` can be described by the determinant.
</span><span class=s2>
</span><span class=s2>        If the determinant is:
</span><span class=s2>            Positive: getting to `self` is a left (counter-clockwise) turn
</span><span class=s2>            Negative: getting to `self` is a right (clock-wise turn) turn
</span><span class=s2>            zero: All three points are on a straight line (colinear)
</span><span class=s2>        &#34;&#34;&#34;</span>
        <span class=n>x1</span><span class=p>,</span> <span class=n>y1</span> <span class=o>=</span> <span class=n>other1</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=n>other1</span><span class=o>.</span><span class=n>y</span>
        <span class=n>x2</span><span class=p>,</span> <span class=n>y2</span> <span class=o>=</span> <span class=n>other2</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=n>other2</span><span class=o>.</span><span class=n>y</span>

        <span class=c1># Compute determinant</span>
        <span class=k>return</span> <span class=p>(</span><span class=n>x2</span> <span class=o>-</span> <span class=n>x1</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>y</span> <span class=o>-</span> <span class=n>y1</span><span class=p>)</span> <span class=o>-</span> <span class=p>(</span><span class=n>y2</span> <span class=o>-</span> <span class=n>y1</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>x</span> <span class=o>-</span> <span class=n>x1</span><span class=p>)</span>

</code></pre></td></tr></table>
</div>
</div><p>With the simple <code>Point</code> class above, we can write the Graham Scan algorithm.</p>
<p>We use two helper methods <code>pop_anchor_point</code> and <code>is_not_left_turn</code> to make the <code>convex_hull_graham_scan</code> function more tidy and make it read almost like pseudocode.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=c1># convex_hull.py</span>
<span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>Tuple</span>
<span class=kn>from</span> <span class=nn>math</span> <span class=kn>import</span> <span class=n>atan2</span>

<span class=kn>from</span> <span class=nn>core</span> <span class=kn>import</span> <span class=n>Point</span>


<span class=k>def</span> <span class=nf>pop_anchor_point</span><span class=p>(</span><span class=n>points</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Point</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Point</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;Return the anchor point from a list of 2D points and remove it from
</span><span class=s2>    the list.
</span><span class=s2>
</span><span class=s2>    Parameters
</span><span class=s2>    ----------
</span><span class=s2>    points
</span><span class=s2>        The list of points from which to extract the anchor point
</span><span class=s2>
</span><span class=s2>    Returns
</span><span class=s2>    -------
</span><span class=s2>    The anchor point, i.e. the point with the smallest y-coordinate.
</span><span class=s2>    If multiple points have the smallest y-coordinate, the point with
</span><span class=s2>    the smallest x-coordinate among those is returned.
</span><span class=s2>
</span><span class=s2>    Note
</span><span class=s2>    ----
</span><span class=s2>    This function mutates the input list.
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=n>anchor</span> <span class=o>=</span> <span class=n>points</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
    <span class=n>anchor_index</span> <span class=o>=</span> <span class=mi>0</span>

    <span class=c1># Loop over the array of points, excluding the first point</span>
    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>p</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>points</span><span class=p>[</span><span class=mi>1</span><span class=p>:],</span> <span class=n>start</span><span class=o>=</span><span class=mi>1</span><span class=p>):</span>

        <span class=n>is_y_smaller</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=n>y</span> <span class=o>&lt;</span> <span class=n>anchor</span><span class=o>.</span><span class=n>y</span>
        <span class=n>is_y_equal_and_x_smaller</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=n>y</span> <span class=o>==</span> <span class=n>anchor</span><span class=o>.</span><span class=n>y</span> <span class=ow>and</span> <span class=n>p</span><span class=o>.</span><span class=n>x</span> <span class=o>&lt;</span> <span class=n>anchor</span><span class=o>.</span><span class=n>x</span>

        <span class=k>if</span> <span class=n>is_y_smaller</span> <span class=ow>or</span> <span class=n>is_y_equal_and_x_smaller</span><span class=p>:</span>
            <span class=c1># New anchor point found</span>
            <span class=n>anchor</span> <span class=o>=</span> <span class=n>p</span>
            <span class=n>anchor_index</span> <span class=o>=</span> <span class=n>i</span>

    <span class=c1># Return the anchor point and remove it from the array</span>
    <span class=k>return</span> <span class=n>points</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>anchor_index</span><span class=p>)</span>


<span class=k>def</span> <span class=nf>is_not_left_turn</span><span class=p>(</span><span class=n>new_point</span><span class=p>:</span> <span class=n>Point</span><span class=p>,</span> <span class=n>point_from</span><span class=p>:</span> <span class=n>Point</span><span class=p>,</span> <span class=n>point_to</span><span class=p>:</span> <span class=n>Point</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;Return True if getting to `new_point` is not a left turn.
</span><span class=s2>
</span><span class=s2>    We travel along the line `point_from` --&gt; `point_to`&#34;&#34;&#34;</span>
    <span class=n>area</span> <span class=o>=</span> <span class=n>new_point</span><span class=o>.</span><span class=n>determinant</span><span class=p>(</span><span class=n>point_from</span><span class=p>,</span> <span class=n>point_to</span><span class=p>)</span>
    <span class=k>return</span> <span class=kc>True</span> <span class=k>if</span> <span class=n>area</span> <span class=o>&lt;=</span> <span class=mi>0</span> <span class=k>else</span> <span class=kc>False</span>


<span class=k>def</span> <span class=nf>convex_hull_graham_scan</span><span class=p>(</span><span class=n>points</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Point</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Point</span><span class=p>]:</span>
    <span class=s2>&#34;&#34;&#34;Return the convex hull using the Graham Scan algorithm.&#34;&#34;&#34;</span>

    <span class=c1># Create a copy of the input list to avoid mutating it</span>
    <span class=n>xy_points</span> <span class=o>=</span> <span class=n>points</span><span class=p>[:]</span>

    <span class=c1># Extract the anchor as the point with min y-coordinate, lowest x in case of a tie</span>
    <span class=n>anchor</span> <span class=o>=</span> <span class=n>pop_anchor_point</span><span class=p>(</span><span class=n>xy_points</span><span class=p>)</span>

    <span class=c1># Sort points acc. to their angle measured from the x-axis to the anchor point in</span>
    <span class=c1># counter-clockwise direction. In case of ties, sort by distance from anchor point.</span>
    <span class=n>xy_points</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>p</span><span class=p>:</span> <span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>angle</span><span class=p>(</span><span class=n>anchor</span><span class=p>),</span> <span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>distance_to</span><span class=p>(</span><span class=n>anchor</span><span class=p>))))</span>

    <span class=c1># Initialize the list of hull points with the anchor and the first point in the</span>
    <span class=c1># sorted points list. These are both guaranteed to be in the convex hull</span>
    <span class=c1># This hull list works as a stack, where we add and pop points as needed. Thus,</span>
    <span class=c1># a point that are added to the hull in an intermediate step might be removed if</span>
    <span class=c1># as we gain more information during the algorithm&#39;s execution.</span>
    <span class=n>hull</span> <span class=o>=</span> <span class=p>[</span><span class=n>anchor</span><span class=p>,</span> <span class=n>xy_points</span><span class=p>[</span><span class=mi>0</span><span class=p>]]</span>

    <span class=k>for</span> <span class=n>point</span> <span class=ow>in</span> <span class=n>xy_points</span><span class=p>[</span><span class=mi>1</span><span class=p>:]:</span>

        <span class=c1># Backtrack to see if any points in the current hull need to be removed</span>
        <span class=k>while</span> <span class=n>is_not_left_turn</span><span class=p>(</span><span class=n>point</span><span class=p>,</span> <span class=n>hull</span><span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>],</span> <span class=n>hull</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]):</span>
            <span class=c1># CASE 1:</span>
            <span class=c1># THe determinant was negative, i.e. the point is on the right side of</span>
            <span class=c1># the line segment formed by the last two point in the hull. Thus, the</span>
            <span class=c1># current last point in the hull list cannot possibly be in the hull.</span>

            <span class=c1># CASE 2:</span>
            <span class=c1># The determinant was 0, i.e. the three points are colinear.</span>
            <span class=c1># We discard the middle point, i.e. the last point in the current hull</span>
            <span class=n>hull</span><span class=o>.</span><span class=n>pop</span><span class=p>()</span>

        <span class=c1># When we get here, the point must be on the left side of the line segment,</span>
        <span class=c1># Thus, we add it to the convex hull.</span>
        <span class=c1># Note that the point is not necessarily part of the final convex hull as it</span>
        <span class=c1># might be removed in future backtracking steps.</span>
        <span class=n>hull</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>point</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>hull</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=references>References</h2>
<p>For a more detailed explanation of the Graham Scan algorithm, check out <a href=https://www.amazon.com/Introduction-Algorithms-3rd-MIT-Press/dp/0262033844><em>Introduction to Algorithms, 3rd Edition</em></a>.</p>
</div>
<div class=post-copyright>
<p class=copyright-item>
<span class=item-title>Author</span>
<span class=item-content>Tim Skov Jacobsen</span>
</p>
<p class=copyright-item>
<span class=item-title>LastMod</span>
<span class=item-content>
2021-08-23
<a href=https://github.com/timskovjacobsen/personal-site/commit/03ea3ee2e326d2558baba5fd51ed920e4a6f1566 title="Updates for better mobile rendering">(03ea3ee)</a>
</span>
</p>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=/tags/convex-hull/>convex-hull</a>
<a href=/tags/algorithms/>algorithms</a>
<a href=/tags/computational-geometry/>computational-geometry</a>
</div>
<nav class=post-nav>
<a class=next href=/post/zero-indexing/>
<span class="next-text nav-default">Why indexing starts at 0</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i>
</a>
</nav>
</footer>
</article>
</div>
</div>
</main>
<footer id=footer class=footer>
<div class=social-links>
<a href=mailto:timskovjacobsen@gmail.com class="iconfont icon-email" title=email></a>
<a href=https://stackoverflow.com/users/5993892/tim-skov-jacobsen class="iconfont icon-stack-overflow" title=stack-overflow></a>
<a href=https://www.linkedin.com/in/tim-skov-jacobsen-14749555/ class="iconfont icon-linkedin" title=linkedin></a>
<a href=https://github.com/timskovjacobsen class="iconfont icon-github" title=github></a>
<a href=http://localhost:1313/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a>
</div>
<div class=copyright>
<span class=power-by>
Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span>
<span class=division>|</span>
<span class=theme-info>
Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a>
</span>
<span class=copyright-year>
&copy;
2021<span class=heart><i class="iconfont icon-heart"></i></span><span>Tim Skov Jacobsen</span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class="iconfont icon-up"></i>
</div>
</div>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script>
<script type=text/javascript>window.MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],tags:'ams'}}</script>
<script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script>
</body>
</html>